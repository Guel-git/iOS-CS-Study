## Chap13. 교착 상태

### 13-1 교착 상태란
일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상

>**식사하는 철학자 문제**

1. 계속 생각을 하다가 왼쪽 포크가 사용 가능하면 집어든다.
2. 계속 생각을 하다가 오른쪽 포크가 사용 가능하면 집어든다.
3. 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 한다.
4. 식사 시간이 끝나면 오른쪽 포크를 내려 놓는다.
5. 다시 1번부터 반복한다.

- 교착 상태가 발생했을 때의 상황을 정확하게 표현하고
- 교착 상태가 일어나는 근본적인 이유 알기

<br>

>**자원 할당 그래프**

어떤 프로세스가 어떤 자원을 사용하고 기다리는지 표현하는 그래프

<img width="545" alt="Screenshot 2023-07-19 at 7 51 25 PM" src="https://github.com/Guel-git/iOS-CS-Study/assets/81340603/3b838362-7f0d-4d58-8e97-7f35b26975f3">

- 프로세스는 원, 자원의 종류는 사각형으로 표현
- 사용 가능한 자원의 개수는 자원 사각형 내 점으로 표현
- 자원을 사용 중이라면 자원 ➡️ 프로세스 화살표
- 자원을 기다리고 있다면 프로세스 ➡️ 자원 화살표

<br>

>**교착 상태 발생 조건**

4가지 조건 모두 만족시 교착 상태 발생의 가능성이 생김, 하나라도 만족하지 않으면 발생하지 않음

- 상호 배제: 한 번에 하나의 프로세스만 이용 가능한 상태
- 점유와 대기: 자원을 할당 받은 상태에서 다른 자원을 기다리는 상태
- 비선점: 자원을 강제로 빼앗지 못함
- 원형 대기: 프로세스들이 원형으로 자원을 대기하는 것

<br>

### 13-2 교착 상태 해결 방법
- 문제를 무시하고 교착 상태가 시스템에서 절대 발생하지 않는 척하기 (타조 알고리즘)
- 교착 상태가 되지 않도록 교착 상태를 **예방**하거나 **회피**하는 프로토콜 사용하기
- 시스템 교착 상태가 되도록 허용한 다음에 복구하기

<br>

>**교착 상태 예방**

교착 상태 발생 조건 네 가지 중 하나를 충족하지 못하게 하는 방법

- 상호 배제: 모든 자원의 상호 배제를 없애기는 현실적으로 어려움
- 점유와 대기: 자원의 활용률이 낮고, 기아 현상 발생 가능
  - 특정 프로세스에 자원을 모두 할당하거나 아예 할당하지 않는 방법
  - 스레드가 자원을 전혀 갖고 있지 않을 때만 자원을 요청 가능하도록 설정
- 비선점: 선점 허용 ➡️ 한 번에 하나의 프로세스만 이용 가능한 자원도 있어 범용성이 떨어짐
- 원형 대기: 모든 자원에 번호를 붙이고 오름차순으로 자원 할당 ➡️ 오버헤드가 큼

<br>

>**교착 상태 회피**

교착 상태가 발생하지 않을 정도로 조금씩 자원을 할당하는 방식

- 안전 상태: 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
- 불안전 상태: 교착 상태가 발생할 수도 있는 상황 (안전 순서열이 없는 상황)
- 안전 순서열: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
  
  <img width="328" alt="Screenshot 2023-07-19 at 8 44 12 PM" src="https://github.com/Guel-git/iOS-CS-Study/assets/81340603/5ff77661-87c0-4716-ab4c-5c29a6947c84">

<br>

>**교착 상태 검출 후 회복**

교착 상태 발생을 인정하고 사후에 조치하는 방식

- 선점을 통한 회복
  - 교착 상태가 해결될 때까지 프로세스 하나에 자원을 몰아주는 방식
  - 교착 상태를 해결하기 위한 선점에서 고려할 점
    1) 희생자 선택 - 어느 자원과 어느 프로세스들이 선점될 것인가?
    2) 후퇴 - 프로세스로부터 자원을 선점하려면, 그 프로세스를 어떻게 해야 하는가? (중지 후 재시작)
    3) 기아 상태 - 기아 상태가 발생하지 않는 것을 어떻게 보장할 수 있는가?
- 프로세스 강제 종료를 통한 회복
  - 교착 상태에 놓인 프로세스를 모두 강제 종료: 가장 확실하지만 작업 내역을 잃을 수 있음
  - 교착 상태가 없어질 때까지 한 개씩 강제 종료: 교착 상태 여부 확인 과정에서 오버헤드 발생 가능
